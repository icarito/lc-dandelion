'From MIT Squeak 0.9.4 (June 1, 2003) [No updates present.] on 30 April 2008 at 1:48:34 pm'!ArgMorph subclass: #SpriteArgMorph	instanceVariableNames: 'menuIconMorph morph '	classVariableNames: ''	poolDictionaries: ''	category: 'Scratch-Blocks'!!SpriteArgMorph commentStamp: '<historical>' prior: 0!I represent a scriptable scratch morph argument for a command block.  Clicking on me and then another point on the screen allows the user to set my value to the scriptable scratch morph that has been clicked on.!!SpriteArgMorph methodsFor: 'initialize' stamp: 'jm 6/22/2007 12:48'!initialize	super initialize.	self borderInset.	self borderWidth: 1.	self color: Color white.	self extent: 20@15.	labelMorph _ StringMorph new font: BlockMorph argFont; color: Color white.	self addMorph: labelMorph.	menuIconMorph _ ImageMorph new form: DropDownMenuForm.	self addMorphFront: menuIconMorph.	morph _ nil.	self updateLabel.! !!SpriteArgMorph methodsFor: 'event handling' stamp: 'jm 1/23/2007 12:33'!handlesMouseDown: evt	^ evt hand toolType isNil and:		[(self topRight - (14@0) corner: self bottomRight) containsPoint: evt cursorPoint]! !!SpriteArgMorph methodsFor: 'event handling' stamp: 'jm 12/13/2006 21:28'!mouseDown: evt	self presentMenu.! !!SpriteArgMorph methodsFor: 'event handling' stamp: 'ee 10/24/2007 19:27'!presentMenu	"Let the user select a Scratch object or the special value #mouse."	| frame sel objList menu choice |	(frame _ self ownerThatIsA: ScratchFrameMorph) ifNil: [^ self].	(owner isKindOf: CommandBlockMorph) ifTrue: [sel _ owner selector].	objList _ frame scratchObjects.	objList sort: [:obj1 :obj2 | obj1 objName asLowercase < obj2 objName asLowercase].	menu _ CustomMenu new.	sel = #getAttribute:of:		ifTrue: [			menu add: ('Stage' localized) action: frame workPane]		ifFalse: [			menu add: 'mouse-pointer' localized action: #mouse.			sel = #touching: ifTrue: [menu add: 'edge' localized action: #edge].			objList _ objList copyWithout: owner receiver].	objList size > 0 ifTrue: [menu addLine].	objList do: [:obj | menu add: obj objName action: obj].	(choice _ menu startUp) ifNil: [^ self].	morph _ choice.	self updateLabel.! !!SpriteArgMorph methodsFor: 'event handling' stamp: 'jm 12/14/2004 11:55'!wantsKeyboardFocusFor: aSubmorph	"Don't allow shift-click editing of block labels."	^ false! !!SpriteArgMorph methodsFor: 'stepping' stamp: 'jm 9/5/2006 11:20'!step	self updateLabel.! !!SpriteArgMorph methodsFor: 'stepping' stamp: 'jm 5/28/2004 18:37'!stepTime	^ 200! !!SpriteArgMorph methodsFor: 'stepping' stamp: 'jm 11/8/2007 14:15'!updateLabel	"Update my label string."	| s |	self checkForDeletedMorph.	s _ ' '.	morph ifNotNil: [		morph = #mouse			ifTrue: [s _ 'mouse-pointer' localized]			ifFalse: [				morph = #edge					ifTrue: [s _ 'edge' localized]					ifFalse: [s _ morph objName]]].	labelMorph contents = s ifFalse: [		labelMorph contents: s.		self width: labelMorph width + 17.		labelMorph position: self position + (4@0).		menuIconMorph position: (self right - borderWidth - 10)@(self top + borderWidth + 4)].! !!SpriteArgMorph methodsFor: 'other' stamp: 'jm 12/5/2007 14:37'!checkForDeletedMorph	"If I refer to a Sprite that has been deleted, nil out my morph field. Do nothing if my morph is a ScratchStageMorph"	(morph isKindOf: Morph) ifFalse: [^ self].	morph owner ifNotNil: [^ self].	(morph isKindOf: ScratchStageMorph) ifTrue: [^ self].	morph _ nil.  "nil out reference to deleted sprite"! !!SpriteArgMorph methodsFor: 'other' stamp: 'jm 12/10/2004 14:11'!clearMorphReference	"Clear my morph reference."	(morph isKindOf: Morph) ifFalse: [^ self].	morph _ nil.	self updateLabel.! !!SpriteArgMorph methodsFor: 'other' stamp: 'jm 3/28/2005 15:14'!defaultValue: aSpriteMorph	morph _ aSpriteMorph.! !!SpriteArgMorph methodsFor: 'other' stamp: 'jm 9/5/2006 11:19'!evaluate	"Answer either nil, the symbol #mouse, or a Scratch sprite object."	self checkForDeletedMorph.	^ morph! !!SpriteArgMorph methodsFor: 'other' stamp: 'jm 3/28/2005 17:03'!fixArgLayout	"Set my color to my owner's color."	self color: (owner color mixed: 0.7 with: (Color gray: 0.3)).! !!SpriteArgMorph methodsFor: 'other' stamp: 'jm 10/30/2005 08:41'!printArgOn: aStream	"Print this argument morph on the given stream."	aStream nextPut: $".	aStream nextPutAll: self labelMorph contents.	aStream nextPut: $".! !!SpriteArgMorph methodsFor: 'object i/o' stamp: 'jm 9/24/2003 18:34'!fieldsVersion	^ 1! !!SpriteArgMorph methodsFor: 'object i/o' stamp: 'jm 9/24/2003 18:35'!initFieldsFrom: anObjStream version: classVersion	super initFieldsFrom: anObjStream version: classVersion.	self initFieldsNamed: #(		morph	) from: anObjStream.! !!SpriteArgMorph methodsFor: 'object i/o' stamp: 'jm 9/24/2003 18:39'!storeFieldsOn: anObjStream	super storeFieldsOn: anObjStream.	self storeFieldsNamed: #(		morph	) on: anObjStream.! !