'From MIT Squeak 0.9.4 (June 1, 2003) [No updates present.] on 30 April 2008 at 1:47:37 pm'!BlockMorph subclass: #CommentBlockMorph	instanceVariableNames: 'labelMorph showHideMorph commentMorph isShowing '	classVariableNames: ''	poolDictionaries: ''	category: 'Scratch-Blocks'!!CommentBlockMorph methodsFor: 'initialization' stamp: 'jm 10/28/2007 22:07'!initialize	super initialize.	self color: (Color r: 0.670 g: 0.685 b: 0.670).	isShowing _ true.	labelMorph _ (StringMorph contents: 'comment' localized font: LabelFont) color: LabelColor.	self addMorph: labelMorph.	commentMorph _ MultilineStringMorph new		growWithText: true;		borderWidth: 1;		borderColor: color darker;		font: (StrikeFont fontName: 'ComicSans' size: 10);		contents: '';		width: 160;		color: (Color gray: 0.88).	self addMorph: commentMorph.	showHideMorph _ ImageMorph new form: (ScratchFrameMorph scratchSkin at: #arrowOpen).	showHideMorph form colors: (Array		with: Color transparent		with: (self color mixed: 0.5 with: Color black)).	self addMorph: showHideMorph.	self fixBlockLayout.! !!CommentBlockMorph methodsFor: 'layout' stamp: 'jm 9/28/2007 17:25'!fixBlockLayout	"Update the positions of my submorphs."	| nextB tabInset xOffset |	blockLayoutNeeded ifFalse: [^ self].	super fixBlockLayout.	tabInset _ 10.	xOffset _ tabInset + ((self width - tabInset - labelMorph width) // 2).	labelMorph position: self position + (xOffset@2).	commentMorph owner = self		ifTrue: [			self extent: commentMorph extent + (10@26).			showHideMorph position: labelMorph topRight + (4@4).			commentMorph position: self position + (5@16)]		ifFalse: [			self height: 22.			showHideMorph position: labelMorph topRight + (5@3)].	(nextB _ self nextBlock) ifNotNil: [		nextB position: self left@(self bottom - 4).		nextB fixBlockLayout].! !!CommentBlockMorph methodsFor: 'event handling' stamp: 'jm 10/1/2007 16:46'!mouseDown: evt	| p |	p _ evt cursorPoint.	((showHideMorph bounds expandBy: 4) containsPoint: p) ifTrue: [^ self toggleShowing].	(isShowing and: [commentMorph containsPoint: p])		ifTrue: [^ commentMorph mouseDown: evt].	super mouseDown: evt.! !!CommentBlockMorph methodsFor: 'event handling' stamp: 'jm 10/26/2007 08:36'!toggleShowing	| colors |	isShowing _ isShowing not.	colors _ showHideMorph form colors.	isShowing		ifTrue: [			showHideMorph form: (ScratchFrameMorph scratchSkin at: #arrowOpen).			showHideMorph form colors: colors.			self addMorph: commentMorph.			commentMorph startStepping]		ifFalse: [			showHideMorph form: (ScratchFrameMorph scratchSkin at: #arrowClosed).			showHideMorph form colors: colors.			commentMorph delete].! !!CommentBlockMorph methodsFor: 'event handling' stamp: 'jm 9/28/2007 17:35'!wantsKeyboardFocusFor: aSubmorph	"Allow editing of my comment."	^ aSubmorph == commentMorph! !!CommentBlockMorph methodsFor: 'private' stamp: 'jm 11/19/2007 10:38'!asBlockTuple	^ Array		with: #comment:		with: commentMorph contents		with: isShowing! !!CommentBlockMorph methodsFor: 'private' stamp: 'jm 10/3/2007 14:34'!comment: aStringOrUTF8	"Set the contents of this comment to the given string."	commentMorph contents: aStringOrUTF8 asString.! !